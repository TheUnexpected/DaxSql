SELECT	'Daños'AS Ramo,
		concat(age.NipPerfilAgente, ' - ', age.NombreAgente) AS Perfil,
		CASE WHEN isnull(emi.NumPolizaAnterior,0)=0 THEN 'Nueva'
		ELSE 'Conservada' END AS Conservacion,
		
		sum(tec.PrimaNetaPropiaPagada) AS Pagada

FROM  HDI_DWH.dbo.TB_BI_DanFactEmisionDoc AS emi

inner JOIN TB_DWH_DanBaseTecnica AS tec
ON tec.NumCompletoCotizacion = emi.NumCompletoCotizacion
AND tec.NumDocumento = emi.NumDocumento 
--AND tec.Periodo>=202207
--AND tec.Periodo<=202411

LEFT JOIN tb_bi_dimagente AS age
ON age.NipPerfilAgente=emi.NipPerfilAgente

WHERE emi.NipPerfilAgente IN (53375,53262,53384,53297,102194,53164,53423,53345,53225,53150,53294,108034,53257,53382,53536,105565,53685,
69799,60116,53873,53761,59622,55166,54034,54113,54851,55124,54156,54778,98380,54241,54243,55182,53864,55818,56438,69347,105690,56354,56620,56849,55753,56538,57895,57120,56239,105571,59042,
56614,56550,56915,57150,56889,90373,57119,58138,102541,57583,58082,69077,57933,69995,61255,67118,58772,59458,59472,59294,58704,58541,58708,
58586,105953,101870,63046,67755,58968,59088,110433,108815,61948,61955,61959,61778,63300,63301,66136,63013,63165,61993,63990,103573,69792,64925,
90329,69724,66378,91645,95335,96149,103845,103362,103269,103459,104189,104539,104540,104605,104670,104679,104913,
104914,104943,105416,106107,106373,106376,105574,105656,108024,110018,110532,112145,112158,112354,105730,111533,108659)
	
GROUP BY 	concat(age.NipPerfilAgente, ' - ', age.NombreAgente),
		CASE WHEN isnull(emi.NumPolizaAnterior,0)=0 THEN 'Nueva'
		ELSE 'Conservada' END 


UNION ALL

SELECT	'Autos'AS Ramo,
		concat(age.NipPerfilAgente, ' - ', age.NombreAgente) AS Perfil,
		conserv.DescGrupoConservacion AS Conservacion,
		
		sum(tec.PrimaNetaPropiaPagada) AS Pagada

FROM  HDI_DWH.dbo.TB_BI_autrFactEmisionDoc AS emi

inner JOIN TB_BI_autrBase2Tecnica AS tec
ON tec.NumCompletoCotizacion = emi.NumCompletoCotizacion
AND tec.NumDocumento = emi.NumDocumento 
--AND tec.Periodo>=202207
--AND tec.Periodo<=202411

LEFT JOIN tb_bi_dimagente AS age
ON age.NipPerfilAgente=emi.NipPerfilAgente

LEFT JOIN TB_Bi_DimTipoConservacion AS conserv
ON conserv.IdTipoConservacion=emi.IdTipoConservacion

WHERE emi.NipPerfilAgente IN (53375,53262,53384,53297,102194,53164,53423,53345,53225,53150,53294,108034,53257,53382,53536,105565,53685,
69799,60116,53873,53761,59622,55166,54034,54113,54851,55124,54156,54778,98380,54241,54243,55182,53864,55818,56438,69347,105690,56354,56620,56849,55753,56538,57895,57120,56239,105571,59042,
56614,56550,56915,57150,56889,90373,57119,58138,102541,57583,58082,69077,57933,69995,61255,67118,58772,59458,59472,59294,58704,58541,58708,
58586,105953,101870,63046,67755,58968,59088,110433,108815,61948,61955,61959,61778,63300,63301,66136,63013,63165,61993,63990,103573,69792,64925,
90329,69724,66378,91645,95335,96149,103845,103362,103269,103459,104189,104539,104540,104605,104670,104679,104913,
104914,104943,105416,106107,106373,106376,105574,105656,108024,110018,110532,112145,112158,112354,105730,111533,108659)
	
GROUP BY 	concat(age.NipPerfilAgente, ' - ', age.NombreAgente),
			conserv.DescGrupoConservacion